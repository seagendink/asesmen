<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMaster - Aplikasi Quiz Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        .slide-up {
            animation: slideUp 0.6s ease-out;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .timer-circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
        }
        
        .question-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .option-button {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .option-button:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .option-button.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.2);
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .drop-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        
        .drop-zone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-graduation-cap text-2xl text-indigo-600 mr-2"></i>
                        <span class="text-xl font-bold text-gray-900">QuizMaster</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="adminBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-cog mr-2"></i>Admin
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="mainContent" class="fade-in">
        <!-- Landing Page -->
        <div id="landingPage" class="gradient-bg min-h-screen flex items-center justify-center p-4">
            <div class="max-w-4xl mx-auto text-center text-white">
                <div class="slide-up">
                    <h1 class="text-5xl md:text-6xl font-bold mb-6">
                        Selamat Datang di <span class="text-yellow-300">QuizMaster</span>
                    </h1>
                    <p class="text-xl md:text-2xl mb-8 opacity-90">
                        Platform quiz interaktif untuk pembelajaran yang menyenangkan
                    </p>
                    <div class="grid md:grid-cols-2 gap-6 mt-12">
                        <div class="card-hover bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-xl p-6 border border-white border-opacity-30">
                            <i class="fas fa-user-graduate text-4xl mb-4 text-yellow-300"></i>
                            <h3 class="text-xl font-semibold mb-2">Untuk Siswa</h3>
                            <p class="opacity-90 mb-4">Ikuti quiz dengan tampilan menarik dan timer yang menantang</p>
                            <button onclick="showStudentLogin()" class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 px-6 py-3 rounded-lg font-semibold transition-colors">
                                Mulai Quiz
                            </button>
                        </div>
                        <div class="card-hover bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-xl p-6 border border-white border-opacity-30">
                            <i class="fas fa-chalkboard-teacher text-4xl mb-4 text-yellow-300"></i>
                            <h3 class="text-xl font-semibold mb-2">Untuk Guru</h3>
                            <p class="opacity-90 mb-4">Kelola soal, monitor hasil, dan analisis pembelajaran</p>
                            <button onclick="showAdminLogin()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                Dashboard Admin
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Student Login -->
        <div id="studentLogin" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md slide-up">
                <div class="text-center mb-6">
                    <i class="fas fa-user-graduate text-4xl text-indigo-600 mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-900">Login Siswa</h2>
                    <p class="text-gray-600">Masukkan username dan password Anda</p>
                </div>
                <form id="studentForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="studentUsername" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="studentPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-semibold transition-colors">
                        Login
                    </button>
                </form>
                <button onclick="showLanding()" class="w-full mt-4 text-gray-600 hover:text-gray-800 transition-colors">
                    ← Kembali
                </button>
            </div>
        </div>

        <!-- Quiz Instructions -->
        <div id="quizInstructions" class="hidden min-h-screen bg-gray-50 py-8">
            <div class="max-w-4xl mx-auto px-4">
                <div class="bg-white rounded-2xl shadow-lg p-8 slide-up">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-900 mb-2" id="quizTitle">Quiz Informatika - Algoritma Dasar</h1>
                        <p class="text-gray-600">Bacalah petunjuk dengan seksama sebelum memulai</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <div class="bg-blue-50 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-blue-900 mb-4">
                                <i class="fas fa-info-circle mr-2"></i>Petunjuk Umum
                            </h3>
                            <ul class="space-y-2 text-blue-800">
                                <li>• Bacalah setiap soal dengan teliti</li>
                                <li>• Pilih jawaban yang paling tepat</li>
                                <li>• Waktu pengerjaan: <span class="font-semibold" id="totalTime">30 menit</span></li>
                                <li>• Jumlah soal: <span class="font-semibold" id="totalQuestions">20 soal</span></li>
                                <li>• Tidak ada pengurangan nilai untuk jawaban salah</li>
                            </ul>
                        </div>
                        
                        <div class="bg-green-50 rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-green-900 mb-4">
                                <i class="fas fa-lightbulb mr-2"></i>Tips Mengerjakan
                            </h3>
                            <ul class="space-y-2 text-green-800">
                                <li>• Kerjakan soal yang mudah terlebih dahulu</li>
                                <li>• Perhatikan waktu yang tersisa</li>
                                <li>• Periksa kembali jawaban sebelum submit</li>
                                <li>• Tetap tenang dan fokus</li>
                                <li>• Jangan lupa berdoa sebelum memulai</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button onclick="startQuiz()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-colors pulse-animation">
                            <i class="fas fa-play mr-2"></i>Mulai Quiz Sekarang
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Page -->
        <div id="quizPage" class="hidden min-h-screen bg-gray-50">
            <!-- Quiz Header -->
            <div class="bg-white shadow-lg sticky top-16 z-40">
                <div class="max-w-6xl mx-auto px-4 py-4">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-600">
                                Soal <span id="currentQuestion">1</span> dari <span id="totalQuestionsDisplay">20</span>
                            </div>
                            <div class="w-64 bg-gray-200 rounded-full h-2">
                                <div id="progressBar" class="progress-bar bg-indigo-600 h-2 rounded-full" style="width: 5%"></div>
                            </div>
                        </div>
                        
                        <!-- Timer -->
                        <div class="flex items-center space-x-4">
                            <div class="relative">
                                <svg class="w-16 h-16 transform -rotate-90">
                                    <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="4" fill="none"></circle>
                                    <circle id="timerCircle" cx="32" cy="32" r="28" stroke="#ef4444" stroke-width="4" fill="none" class="timer-circle"></circle>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="timeDisplay" class="text-sm font-bold text-red-600">30:00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question Content -->
            <div class="max-w-4xl mx-auto px-4 py-8">
                <div id="questionContainer" class="question-card rounded-2xl p-8 mb-6">
                    <!-- Question will be loaded here -->
                </div>
                
                <!-- Navigation -->
                <div class="flex justify-between items-center">
                    <button id="prevBtn" onclick="previousQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-left mr-2"></i>Sebelumnya
                    </button>
                    
                    <div class="flex space-x-2">
                        <button onclick="showQuestionNav()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition-colors">
                            <i class="fas fa-th mr-2"></i>Navigasi Soal
                        </button>
                        <button id="submitBtn" onclick="submitQuiz()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            <i class="fas fa-paper-plane mr-2"></i>Submit Quiz
                        </button>
                    </div>
                    
                    <button id="nextBtn" onclick="nextQuestion()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        Selanjutnya<i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Login -->
        <div id="adminLogin" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md slide-up">
                <div class="text-center mb-6">
                    <i class="fas fa-shield-alt text-4xl text-indigo-600 mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-900">Login Admin</h2>
                    <p class="text-gray-600">Masukkan kredensial admin</p>
                </div>
                <form id="adminLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="adminUsername" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="adminPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-semibold transition-colors">
                        Login
                    </button>
                </form>
                <button onclick="showLanding()" class="w-full mt-4 text-gray-600 hover:text-gray-800 transition-colors">
                    ← Kembali
                </button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden min-h-screen bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 py-8">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Dashboard Admin</h1>
                    <p class="text-gray-600">Kelola quiz dan monitor hasil siswa</p>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-full">
                                <i class="fas fa-question-circle text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Total Soal</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalQuestionsCount">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-full">
                                <i class="fas fa-users text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Total Siswa</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalStudents">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <i class="fas fa-clock text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Durasi Quiz</p>
                                <p class="text-2xl font-bold text-gray-900" id="quizDuration">30 min</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-full">
                                <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Rata-rata Nilai</p>
                                <p class="text-2xl font-bold text-gray-900" id="averageScore">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <button onclick="showAddQuestion()" class="bg-indigo-600 hover:bg-indigo-700 text-white p-6 rounded-xl font-semibold text-lg transition-colors card-hover">
                        <i class="fas fa-plus-circle text-2xl mb-2"></i>
                        <div>Tambah Soal</div>
                    </button>
                    
                    <button onclick="showImportQuestions()" class="bg-green-600 hover:bg-green-700 text-white p-6 rounded-xl font-semibold text-lg transition-colors card-hover">
                        <i class="fas fa-file-import text-2xl mb-2"></i>
                        <div>Import Soal</div>
                    </button>
                    
                    <button onclick="showStudentManagement()" class="bg-orange-600 hover:bg-orange-700 text-white p-6 rounded-xl font-semibold text-lg transition-colors card-hover">
                        <i class="fas fa-users text-2xl mb-2"></i>
                        <div>Kelola Siswa</div>
                    </button>
                    
                    <button onclick="showResults()" class="bg-purple-600 hover:bg-purple-700 text-white p-6 rounded-xl font-semibold text-lg transition-colors card-hover">
                        <i class="fas fa-chart-bar text-2xl mb-2"></i>
                        <div>Lihat Hasil</div>
                    </button>
                </div>
                
                <!-- Questions List -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Daftar Soal</h2>
                        <div class="flex space-x-2">
                            <button onclick="clearAllQuestions()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-trash mr-2"></i>Hapus Semua
                            </button>
                            <button onclick="exportResults()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-download mr-2"></i>Export Excel
                            </button>
                        </div>
                    </div>
                    <div id="questionsList" class="space-y-4">
                        <!-- Questions will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals and overlays will be added here -->
    <div id="modalOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div id="modalContent" class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <!-- Modal content will be loaded here -->
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let questions = [];
        let students = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let quizTimer = null;
        let timeRemaining = 1800; // 30 minutes in seconds
        let adminCredentials = { username: 'admin', password: 'admin123' };

        // Sample questions data
        const sampleQuestions = [
            {
                id: 1,
                type: 'multiple_choice',
                question: 'Apa yang dimaksud dengan algoritma?',
                options: [
                    'Bahasa pemrograman',
                    'Langkah-langkah sistematis untuk menyelesaikan masalah',
                    'Perangkat keras komputer',
                    'Sistem operasi'
                ],
                correct: 1,
                image: null,
                video: null
            },
            {
                id: 2,
                type: 'true_false',
                question: 'Flowchart adalah representasi visual dari algoritma.',
                options: ['Benar', 'Salah'],
                correct: 0,
                image: null,
                video: null
            },
            {
                id: 3,
                type: 'multiple_choice',
                question: 'Manakah yang bukan termasuk struktur kontrol dalam pemrograman?',
                options: [
                    'Sequence (Urutan)',
                    'Selection (Pemilihan)',
                    'Iteration (Perulangan)',
                    'Compilation (Kompilasi)'
                ],
                correct: 3,
                image: null,
                video: null
            }
        ];

        // Sample students data
        const sampleStudents = [
            { id: 1, username: 'siswa001', password: 'pass123', name: 'Ahmad Rizki', class: '7A', number: 1 },
            { id: 2, username: 'siswa002', password: 'pass123', name: 'Siti Nurhaliza', class: '7A', number: 2 },
            { id: 3, username: 'siswa003', password: 'pass123', name: 'Budi Santoso', class: '7B', number: 1 }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            updateStats();
        });

        // Navigation functions
        function showLanding() {
            hideAllPages();
            document.getElementById('landingPage').classList.remove('hidden');
        }

        function showStudentLogin() {
            hideAllPages();
            document.getElementById('studentLogin').classList.remove('hidden');
        }

        function showAdminLogin() {
            hideAllPages();
            document.getElementById('adminLogin').classList.remove('hidden');
        }

        function hideAllPages() {
            const pages = ['landingPage', 'studentLogin', 'quizInstructions', 'quizPage', 'adminLogin', 'adminDashboard'];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }

        // Student login handling
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('studentUsername').value;
            const password = document.getElementById('studentPassword').value;
            
            const student = students.find(s => s.username === username && s.password === password);
            
            if (student) {
                currentUser = student;
                showQuizInstructions();
            } else {
                alert('Username atau password salah!');
            }
        });

        function showQuizInstructions() {
            hideAllPages();
            document.getElementById('quizInstructions').classList.remove('hidden');
            document.getElementById('totalQuestions').textContent = questions.length;
        }

        function startQuiz() {
            hideAllPages();
            document.getElementById('quizPage').classList.remove('hidden');
            currentQuestionIndex = 0;
            userAnswers = {};
            timeRemaining = 1800; // Reset timer
            startTimer();
            loadQuestion();
            updateProgress();
        }

        // Timer functions
        function startTimer() {
            const circle = document.getElementById('timerCircle');
            const display = document.getElementById('timeDisplay');
            const totalTime = 1800;
            
            quizTimer = setInterval(() => {
                timeRemaining--;
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                display.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update circle progress
                const progress = (totalTime - timeRemaining) / totalTime;
                const offset = 283 - (progress * 283);
                circle.style.strokeDashoffset = offset;
                
                // Change color based on time remaining
                if (timeRemaining <= 300) { // Last 5 minutes
                    circle.style.stroke = '#ef4444'; // Red
                } else if (timeRemaining <= 600) { // Last 10 minutes
                    circle.style.stroke = '#f59e0b'; // Yellow
                } else {
                    circle.style.stroke = '#10b981'; // Green
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(quizTimer);
                    submitQuiz();
                }
            }, 1000);
        }

        // Question loading and navigation
        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            if (!question) return;
            
            const container = document.getElementById('questionContainer');
            let optionsHtml = '';
            
            switch(question.type) {
                case 'multiple_choice':
                    optionsHtml = question.options.map((option, index) => `
                        <button class="option-button w-full text-left p-4 rounded-lg border-2 mb-3 hover:bg-gray-50 transition-colors" 
                                onclick="selectAnswer(${index})" data-option="${index}">
                            <span class="font-medium">${String.fromCharCode(65 + index)}.</span> ${option}
                        </button>
                    `).join('');
                    break;
                    
                case 'true_false':
                    optionsHtml = question.options.map((option, index) => `
                        <button class="option-button w-full text-left p-4 rounded-lg border-2 mb-3 hover:bg-gray-50 transition-colors" 
                                onclick="selectAnswer(${index})" data-option="${index}">
                            <span class="font-medium">${index === 0 ? 'A' : 'B'}.</span> ${option}
                        </button>
                    `).join('');
                    break;
            }
            
            container.innerHTML = `
                <div class="mb-6">
                    <div class="flex items-center mb-4">
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${question.type === 'multiple_choice' ? 'Pilihan Ganda' : 'Benar/Salah'}
                        </span>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">
                        ${currentQuestionIndex + 1}. ${question.question}
                    </h2>
                    ${question.image ? `<img src="${question.image}" class="max-w-full h-auto rounded-lg mb-4" alt="Question image">` : ''}
                    ${question.video ? `<video controls class="max-w-full h-auto rounded-lg mb-4"><source src="${question.video}" type="video/mp4"></video>` : ''}
                </div>
                <div class="space-y-3">
                    ${optionsHtml}
                </div>
            `;
            
            // Restore previous answer if exists
            if (userAnswers[question.id] !== undefined) {
                const selectedButton = container.querySelector(`[data-option="${userAnswers[question.id]}"]`);
                if (selectedButton) {
                    selectedButton.classList.add('selected');
                }
            }
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').style.display = currentQuestionIndex === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submitBtn').style.display = currentQuestionIndex === questions.length - 1 ? 'block' : 'none';
            
            // Update question counter
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestionsDisplay').textContent = questions.length;
        }

        function selectAnswer(optionIndex) {
            const question = questions[currentQuestionIndex];
            userAnswers[question.id] = optionIndex;
            
            // Update UI
            const container = document.getElementById('questionContainer');
            const buttons = container.querySelectorAll('.option-button');
            buttons.forEach(btn => btn.classList.remove('selected'));
            buttons[optionIndex].classList.add('selected');
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
                updateProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function submitQuiz() {
            if (quizTimer) {
                clearInterval(quizTimer);
            }
            
            // Calculate score
            let correct = 0;
            questions.forEach(question => {
                if (userAnswers[question.id] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / questions.length) * 100);
            
            // Save result
            const result = {
                student: currentUser,
                score: score,
                correct: correct,
                total: questions.length,
                answers: userAnswers,
                timestamp: new Date().toISOString()
            };
            
            saveResult(result);
            showResult(result);
        }

        function showResult(result) {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-8 text-center">
                    <div class="mb-6">
                        <div class="w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center ${result.score >= 70 ? 'bg-green-100' : 'bg-red-100'}">
                            <i class="fas ${result.score >= 70 ? 'fa-check text-green-600' : 'fa-times text-red-600'} text-3xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Quiz Selesai!</h2>
                        <p class="text-gray-600">Terima kasih ${result.student.name}</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-6 mb-6">
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <div class="text-3xl font-bold ${result.score >= 70 ? 'text-green-600' : 'text-red-600'}">${result.score}</div>
                                <div class="text-sm text-gray-600">Nilai</div>
                            </div>
                            <div>
                                <div class="text-3xl font-bold text-gray-900">${result.correct}/${result.total}</div>
                                <div class="text-sm text-gray-600">Benar</div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="closeModal(); showLanding();" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        Kembali ke Beranda
                    </button>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Admin functions
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                showAdminDashboard();
            } else {
                alert('Username atau password salah!');
            }
        });

        function showAdminDashboard() {
            hideAllPages();
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadQuestionsList();
            updateStats();
        }

        function loadSampleData() {
            questions = [...sampleQuestions];
            students = [...sampleStudents];
        }

        function updateStats() {
            document.getElementById('totalQuestionsCount').textContent = questions.length;
            document.getElementById('totalStudents').textContent = students.length;
            
            // Get results from localStorage
            const results = JSON.parse(localStorage.getItem('quizResults') || '[]');
            
            if (results.length > 0) {
                const avgScore = results.reduce((sum, result) => sum + result.score, 0) / results.length;
                document.getElementById('averageScore').textContent = Math.round(avgScore);
            }
        }

        function loadQuestionsList() {
            const container = document.getElementById('questionsList');
            
            if (questions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-question-circle text-4xl mb-4"></i>
                        <p>Belum ada soal. Tambahkan soal pertama Anda!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = questions.map((question, index) => `
                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-2">
                                    ${question.type === 'multiple_choice' ? 'Pilihan Ganda' : 'Benar/Salah'}
                                </span>
                                <span class="text-sm text-gray-500">Soal #${index + 1}</span>
                                ${question.image ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium ml-2"><i class="fas fa-image mr-1"></i>Ada Gambar</span>' : ''}
                            </div>
                            <p class="text-gray-900 font-medium mb-2">${question.question}</p>
                            ${question.image ? `<img src="${question.image}" class="max-w-32 h-20 object-cover rounded-lg mb-2" alt="Question image">` : ''}
                            <p class="text-sm text-gray-600">
                                Jawaban: ${question.options[question.correct]}
                            </p>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editQuestion(${question.id})" class="text-blue-600 hover:text-blue-800 p-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteQuestion(${question.id})" class="text-red-600 hover:text-red-800 p-2">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Student Management Functions
        function showStudentManagement() {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Manajemen Siswa</h2>
                        <button onclick="showAddStudent()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah Siswa
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <button onclick="downloadStudentTemplate()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors mr-2">
                            <i class="fas fa-download mr-2"></i>Download Template
                        </button>
                        <button onclick="showImportStudents()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-upload mr-2"></i>Import Siswa
                        </button>
                    </div>
                    
                    <div class="max-h-96 overflow-y-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-4 py-2 text-left">Username</th>
                                    <th class="px-4 py-2 text-left">Nama</th>
                                    <th class="px-4 py-2 text-left">Kelas</th>
                                    <th class="px-4 py-2 text-center">No. Absen</th>
                                    <th class="px-4 py-2 text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${students.map(student => `
                                    <tr class="border-t">
                                        <td class="px-4 py-2 font-mono text-sm">${student.username}</td>
                                        <td class="px-4 py-2">${student.name}</td>
                                        <td class="px-4 py-2">${student.class}</td>
                                        <td class="px-4 py-2 text-center">${student.number}</td>
                                        <td class="px-4 py-2 text-center">
                                            <button onclick="editStudent(${student.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="deleteStudent(${student.id})" class="text-red-600 hover:text-red-800">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4 mt-4 border-t">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function showAddStudent() {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Tambah Siswa Baru</h2>
                    <form id="addStudentForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input type="text" id="studentUsernameAdd" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="text" id="studentPasswordAdd" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                            <input type="text" id="studentNameAdd" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="studentClassAdd" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Pilih Kelas</option>
                                    <option value="7A">7A</option>
                                    <option value="7B">7B</option>
                                    <option value="8A">8A</option>
                                    <option value="8B">8B</option>
                                    <option value="9A">9A</option>
                                    <option value="9B">9B</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Absen</label>
                                <input type="number" id="studentNumberAdd" required min="1" max="40" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="showStudentManagement()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                                Batal
                            </button>
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition-colors">
                                Simpan Siswa
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.classList.remove('hidden');
            
            // Form submission
            document.getElementById('addStudentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('studentUsernameAdd').value;
                const password = document.getElementById('studentPasswordAdd').value;
                const name = document.getElementById('studentNameAdd').value;
                const studentClass = document.getElementById('studentClassAdd').value;
                const number = parseInt(document.getElementById('studentNumberAdd').value);
                
                // Check if username already exists
                if (students.find(s => s.username === username)) {
                    alert('Username sudah digunakan!');
                    return;
                }
                
                const newStudent = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    name: name,
                    class: studentClass,
                    number: number
                };
                
                students.push(newStudent);
                showStudentManagement();
                updateStats();
                showNotification('Siswa berhasil ditambahkan!', 'success');
            });
        }

        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Edit Siswa</h2>
                    <form id="editStudentForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input type="text" id="editStudentUsername" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="${student.username}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="text" id="editStudentPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="${student.password}">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                            <input type="text" id="editStudentName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="${student.name}">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="editStudentClass" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Pilih Kelas</option>
                                    <option value="7A" ${student.class === '7A' ? 'selected' : ''}>7A</option>
                                    <option value="7B" ${student.class === '7B' ? 'selected' : ''}>7B</option>
                                    <option value="8A" ${student.class === '8A' ? 'selected' : ''}>8A</option>
                                    <option value="8B" ${student.class === '8B' ? 'selected' : ''}>8B</option>
                                    <option value="9A" ${student.class === '9A' ? 'selected' : ''}>9A</option>
                                    <option value="9B" ${student.class === '9B' ? 'selected' : ''}>9B</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Absen</label>
                                <input type="number" id="editStudentNumber" required min="1" max="40" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="${student.number}">
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="showStudentManagement()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                                Batal
                            </button>
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition-colors">
                                Update Siswa
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.classList.remove('hidden');
            
            // Form submission
            document.getElementById('editStudentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('editStudentUsername').value;
                const password = document.getElementById('editStudentPassword').value;
                const name = document.getElementById('editStudentName').value;
                const studentClass = document.getElementById('editStudentClass').value;
                const number = parseInt(document.getElementById('editStudentNumber').value);
                
                // Check if username already exists (excluding current student)
                const existingStudent = students.find(s => s.username === username && s.id !== student.id);
                if (existingStudent) {
                    alert('Username sudah digunakan oleh siswa lain!');
                    return;
                }
                
                // Update the student
                const studentIndex = students.findIndex(s => s.id === student.id);
                if (studentIndex !== -1) {
                    students[studentIndex] = {
                        ...student,
                        username: username,
                        password: password,
                        name: name,
                        class: studentClass,
                        number: number
                    };
                }
                
                showStudentManagement();
                updateStats();
                showNotification('Data siswa berhasil diupdate!', 'success');
            });
        }

        function deleteStudent(id) {
            if (confirm('Apakah Anda yakin ingin menghapus siswa ini?')) {
                students = students.filter(s => s.id !== id);
                showStudentManagement();
                updateStats();
                showNotification('Siswa berhasil dihapus!', 'success');
            }
        }

        function showImportStudents() {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Import Siswa dari File</h2>
                    
                    <div class="mb-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h3 class="font-semibold text-blue-900 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>Format File CSV
                            </h3>
                            <p class="text-blue-800 text-sm mb-2">File harus berformat CSV dengan kolom berikut:</p>
                            <code class="text-xs bg-blue-100 px-2 py-1 rounded">username,password,name,class,number</code>
                        </div>
                        
                        <button onclick="downloadStudentTemplate()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors mb-4">
                            <i class="fas fa-download mr-2"></i>Download Template
                        </button>
                    </div>
                    
                    <div class="drop-zone border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-4" id="studentDropZone">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 mb-2">Drag & drop file CSV di sini atau</p>
                        <input type="file" id="studentCsvFileInput" accept=".csv" class="hidden">
                        <button onclick="document.getElementById('studentCsvFileInput').click()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors">
                            Pilih File
                        </button>
                    </div>
                    
                    <div id="studentImportPreview" class="hidden">
                        <h3 class="font-semibold text-gray-900 mb-2">Preview Import:</h3>
                        <div id="studentPreviewContent" class="bg-gray-50 rounded-lg p-4 max-h-40 overflow-y-auto text-sm"></div>
                        <div class="flex justify-end space-x-2 mt-4">
                            <button onclick="cancelStudentImport()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                                Batal
                            </button>
                            <button onclick="confirmStudentImport()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                Import Siswa
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4 mt-4 border-t">
                        <button onclick="showStudentManagement()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                            Kembali
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setupStudentImportHandlers();
        }

        function setupStudentImportHandlers() {
            const dropZone = document.getElementById('studentDropZone');
            const fileInput = document.getElementById('studentCsvFileInput');
            
            // Drag and drop handlers
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleStudentFileSelect(files[0]);
                }
            });
            
            // File input handler
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleStudentFileSelect(e.target.files[0]);
                }
            });
        }

        let importedStudents = [];

        function handleStudentFileSelect(file) {
            if (!file.name.endsWith('.csv')) {
                alert('Hanya file CSV yang diperbolehkan!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                parseStudentCSV(csv);
            };
            reader.readAsText(file);
        }

        function parseStudentCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            // Validate headers
            const expectedHeaders = ['username', 'password', 'name', 'class', 'number'];
            const isValidFormat = expectedHeaders.every(header => headers.includes(header));
            
            if (!isValidFormat) {
                alert('Format file tidak sesuai! Pastikan header CSV sesuai dengan template.');
                return;
            }
            
            importedStudents = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                
                if (values.length < 5) continue;
                
                const username = values[0];
                const password = values[1];
                const name = values[2];
                const studentClass = values[3];
                const number = parseInt(values[4]);
                
                importedStudents.push({
                    id: Date.now() + i,
                    username: username,
                    password: password,
                    name: name,
                    class: studentClass,
                    number: number
                });
            }
            
            showStudentImportPreview();
        }

        function showStudentImportPreview() {
            const preview = document.getElementById('studentImportPreview');
            const content = document.getElementById('studentPreviewContent');
            
            content.innerHTML = importedStudents.map((s, index) => `
                <div class="mb-2 p-2 border border-gray-200 rounded">
                    <strong>${s.name}</strong> (${s.username})<br>
                    <small class="text-gray-600">Kelas: ${s.class} | No. Absen: ${s.number}</small>
                </div>
            `).join('');
            
            preview.classList.remove('hidden');
        }

        function confirmStudentImport() {
            // Check for duplicate usernames
            const existingUsernames = students.map(s => s.username);
            const duplicates = importedStudents.filter(s => existingUsernames.includes(s.username));
            
            if (duplicates.length > 0) {
                const duplicateNames = duplicates.map(s => s.username).join(', ');
                if (!confirm(`Username berikut sudah ada: ${duplicateNames}. Lanjutkan import (akan dilewati)?`)) {
                    return;
                }
                // Remove duplicates
                importedStudents = importedStudents.filter(s => !existingUsernames.includes(s.username));
            }
            
            students.push(...importedStudents);
            showStudentManagement();
            updateStats();
            showNotification(`${importedStudents.length} siswa berhasil diimport!`, 'success');
        }

        function cancelStudentImport() {
            document.getElementById('studentImportPreview').classList.add('hidden');
            importedStudents = [];
        }

        function downloadStudentTemplate() {
            const csvContent = 'username,password,name,class,number\nsiswa001,pass123,Ahmad Rizki,7A,1\nsiswa002,pass123,Siti Nurhaliza,7A,2\nsiswa003,pass123,Budi Santoso,7B,1';
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'template_siswa.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Template berhasil didownload!', 'success');
        }

        // Import Questions Function
        function showImportQuestions() {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Import Soal dari File</h2>
                    
                    <div class="mb-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h3 class="font-semibold text-blue-900 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>Format File CSV
                            </h3>
                            <p class="text-blue-800 text-sm mb-2">File harus berformat CSV dengan kolom berikut:</p>
                            <code class="text-xs bg-blue-100 px-2 py-1 rounded">type,question,option1,option2,option3,option4,correct,image</code>
                            <p class="text-blue-800 text-sm mt-2">
                                • <strong>type:</strong> multiple_choice atau true_false<br>
                                • <strong>question:</strong> Teks pertanyaan<br>
                                • <strong>option1-4:</strong> Pilihan jawaban (untuk true_false hanya isi option1=Benar, option2=Salah)<br>
                                • <strong>correct:</strong> Nomor jawaban benar (0-3)<br>
                                • <strong>image:</strong> URL gambar (opsional, kosongkan jika tidak ada)
                            </p>
                        </div>
                        
                        <button onclick="downloadQuestionTemplate()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors mb-4">
                            <i class="fas fa-download mr-2"></i>Download Template
                        </button>
                    </div>
                    
                    <div class="drop-zone border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-4" id="dropZone">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 mb-2">Drag & drop file CSV di sini atau</p>
                        <input type="file" id="csvFileInput" accept=".csv" class="hidden">
                        <button onclick="document.getElementById('csvFileInput').click()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors">
                            Pilih File
                        </button>
                    </div>
                    
                    <div id="importPreview" class="hidden">
                        <h3 class="font-semibold text-gray-900 mb-2">Preview Import:</h3>
                        <div id="previewContent" class="bg-gray-50 rounded-lg p-4 max-h-40 overflow-y-auto text-sm"></div>
                        <div class="flex justify-end space-x-2 mt-4">
                            <button onclick="cancelImport()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                                Batal
                            </button>
                            <button onclick="confirmImport()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                Import Soal
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4 mt-4 border-t">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setupImportHandlers();
        }

        function setupImportHandlers() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('csvFileInput');
            
            // Drag and drop handlers
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });
            
            // File input handler
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });
        }

        let importedQuestions = [];

        function handleFileSelect(file) {
            if (!file.name.endsWith('.csv')) {
                alert('Hanya file CSV yang diperbolehkan!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                parseCSV(csv);
            };
            reader.readAsText(file);
        }

        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            // Validate headers (image column is optional)
            const requiredHeaders = ['type', 'question', 'option1', 'option2', 'option3', 'option4', 'correct'];
            const isValidFormat = requiredHeaders.every(header => headers.includes(header));
            
            if (!isValidFormat) {
                alert('Format file tidak sesuai! Pastikan header CSV sesuai dengan template.');
                return;
            }
            
            const hasImageColumn = headers.includes('image');
            
            importedQuestions = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                
                if (values.length < 7) continue;
                
                const type = values[0];
                const question = values[1];
                const options = [values[2], values[3], values[4], values[5]].filter(opt => opt);
                const correct = parseInt(values[6]);
                const imageUrl = hasImageColumn && values[7] ? values[7] : null;
                
                if (type === 'true_false') {
                    options.length = 2; // Only keep first 2 options for true/false
                }
                
                importedQuestions.push({
                    id: Date.now() + i,
                    type: type,
                    question: question,
                    options: options,
                    correct: correct,
                    image: imageUrl,
                    video: null
                });
            }
            
            showImportPreview();
        }

        function showImportPreview() {
            const preview = document.getElementById('importPreview');
            const content = document.getElementById('previewContent');
            
            content.innerHTML = importedQuestions.map((q, index) => `
                <div class="mb-2 p-2 border border-gray-200 rounded">
                    <strong>${index + 1}. ${q.question}</strong><br>
                    <small class="text-gray-600">${q.type} - Jawaban: ${q.options[q.correct]}</small>
                </div>
            `).join('');
            
            preview.classList.remove('hidden');
        }

        function confirmImport() {
            questions.push(...importedQuestions);
            closeModal();
            loadQuestionsList();
            updateStats();
            showNotification(`${importedQuestions.length} soal berhasil diimport!`, 'success');
        }

        function cancelImport() {
            document.getElementById('importPreview').classList.add('hidden');
            importedQuestions = [];
        }

        function downloadQuestionTemplate() {
            const csvContent = 'type,question,option1,option2,option3,option4,correct,image\nmultiple_choice,"Apa yang dimaksud dengan algoritma?","Bahasa pemrograman","Langkah-langkah sistematis untuk menyelesaikan masalah","Perangkat keras komputer","Sistem operasi",1,""\ntrue_false,"Flowchart adalah representasi visual dari algoritma.","Benar","Salah","","",0,"https://example.com/flowchart.jpg"';
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'template_soal.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Template berhasil didownload!', 'success');
        }

        function showAddQuestion() {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Tambah Soal Baru</h2>
                    <form id="addQuestionForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipe Soal</label>
                            <select id="questionType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="multiple_choice">Pilihan Ganda</option>
                                <option value="true_false">Benar/Salah</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pertanyaan</label>
                            <textarea id="questionText" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" required></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gambar (Opsional)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <input type="file" id="questionImage" accept="image/*" class="hidden">
                                <div id="imagePreview" class="hidden mb-3">
                                    <img id="previewImg" class="max-w-full h-48 object-contain rounded-lg mx-auto">
                                    <button type="button" onclick="removeImage()" class="mt-2 text-red-600 hover:text-red-800 text-sm">
                                        <i class="fas fa-trash mr-1"></i>Hapus Gambar
                                    </button>
                                </div>
                                <div id="imageUploadArea" class="text-center">
                                    <i class="fas fa-image text-3xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-600 mb-2">Klik untuk upload gambar</p>
                                    <button type="button" onclick="document.getElementById('questionImage').click()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-upload mr-2"></i>Pilih Gambar
                                    </button>
                                    <p class="text-xs text-gray-500 mt-2">Format: JPG, PNG, GIF (Max: 5MB)</p>
                                </div>
                            </div>
                        </div>
                        
                        <div id="optionsContainer">
                            <!-- Options will be generated based on question type -->
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jawaban Benar</label>
                            <select id="correctAnswer" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <!-- Options will be populated -->
                            </select>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                                Batal
                            </button>
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition-colors">
                                Simpan Soal
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.classList.remove('hidden');
            
            // Setup form handlers
            setupAddQuestionForm();
        }

        // Image handling functions
        function setupImageUpload() {
            const imageInput = document.getElementById('questionImage');
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            const uploadArea = document.getElementById('imageUploadArea');
            
            if (imageInput) {
                imageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Validate file size (5MB max)
                        if (file.size > 5 * 1024 * 1024) {
                            alert('Ukuran file terlalu besar! Maksimal 5MB.');
                            return;
                        }
                        
                        // Validate file type
                        if (!file.type.startsWith('image/')) {
                            alert('File harus berupa gambar!');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImg.src = e.target.result;
                            preview.classList.remove('hidden');
                            uploadArea.classList.add('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }
        
        function setupEditImageUpload() {
            const imageInput = document.getElementById('editQuestionImage');
            const preview = document.getElementById('editImagePreview');
            const previewImg = document.getElementById('editPreviewImg');
            const uploadArea = document.getElementById('editImageUploadArea');
            
            if (imageInput) {
                imageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Validate file size (5MB max)
                        if (file.size > 5 * 1024 * 1024) {
                            alert('Ukuran file terlalu besar! Maksimal 5MB.');
                            return;
                        }
                        
                        // Validate file type
                        if (!file.type.startsWith('image/')) {
                            alert('File harus berupa gambar!');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImg.src = e.target.result;
                            preview.classList.remove('hidden');
                            uploadArea.classList.add('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }
        
        function removeImage() {
            const preview = document.getElementById('imagePreview');
            const uploadArea = document.getElementById('imageUploadArea');
            const imageInput = document.getElementById('questionImage');
            
            preview.classList.add('hidden');
            uploadArea.classList.remove('hidden');
            imageInput.value = '';
        }
        
        function removeEditImage() {
            const preview = document.getElementById('editImagePreview');
            const uploadArea = document.getElementById('editImageUploadArea');
            const imageInput = document.getElementById('editQuestionImage');
            
            preview.classList.add('hidden');
            uploadArea.classList.remove('hidden');
            imageInput.value = '';
        }

        function setupAddQuestionForm() {
            const typeSelect = document.getElementById('questionType');
            const optionsContainer = document.getElementById('optionsContainer');
            const correctSelect = document.getElementById('correctAnswer');
            
            // Setup image upload
            setupImageUpload();
            
            function updateOptions() {
                const type = typeSelect.value;
                
                if (type === 'multiple_choice') {
                    optionsContainer.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pilihan Jawaban</label>
                            <div class="space-y-2">
                                <input type="text" id="option0" placeholder="Pilihan A" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                                <input type="text" id="option1" placeholder="Pilihan B" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                                <input type="text" id="option2" placeholder="Pilihan C" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                                <input type="text" id="option3" placeholder="Pilihan D" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                            </div>
                        </div>
                    `;
                    
                    correctSelect.innerHTML = `
                        <option value="0">A</option>
                        <option value="1">B</option>
                        <option value="2">C</option>
                        <option value="3">D</option>
                    `;
                } else {
                    optionsContainer.innerHTML = '';
                    correctSelect.innerHTML = `
                        <option value="0">Benar</option>
                        <option value="1">Salah</option>
                    `;
                }
            }
            
            typeSelect.addEventListener('change', updateOptions);
            updateOptions();
            
            // Form submission
            document.getElementById('addQuestionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const type = typeSelect.value;
                const questionText = document.getElementById('questionText').value;
                const correct = parseInt(correctSelect.value);
                
                let options = [];
                if (type === 'multiple_choice') {
                    options = [
                        document.getElementById('option0').value,
                        document.getElementById('option1').value,
                        document.getElementById('option2').value,
                        document.getElementById('option3').value
                    ];
                } else {
                    options = ['Benar', 'Salah'];
                }
                
                // Get image data if uploaded
                let imageData = null;
                const previewImg = document.getElementById('previewImg');
                if (previewImg && previewImg.src && !previewImg.src.includes('data:')) {
                    imageData = previewImg.src;
                } else if (previewImg && previewImg.src.startsWith('data:')) {
                    imageData = previewImg.src;
                }
                
                const newQuestion = {
                    id: Date.now(),
                    type: type,
                    question: questionText,
                    options: options,
                    correct: correct,
                    image: imageData,
                    video: null
                };
                
                questions.push(newQuestion);
                closeModal();
                loadQuestionsList();
                updateStats();
                
                // Show success message
                showNotification('Soal berhasil ditambahkan!', 'success');
            });
        }

        function editQuestion(id) {
            const question = questions.find(q => q.id === id);
            if (!question) return;
            
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Edit Soal</h2>
                    <form id="editQuestionForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipe Soal</label>
                            <select id="editQuestionType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="multiple_choice" ${question.type === 'multiple_choice' ? 'selected' : ''}>Pilihan Ganda</option>
                                <option value="true_false" ${question.type === 'true_false' ? 'selected' : ''}>Benar/Salah</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pertanyaan</label>
                            <textarea id="editQuestionText" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" required>${question.question}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gambar (Opsional)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <input type="file" id="editQuestionImage" accept="image/*" class="hidden">
                                <div id="editImagePreview" class="${question.image ? '' : 'hidden'} mb-3">
                                    <img id="editPreviewImg" src="${question.image || ''}" class="max-w-full h-48 object-contain rounded-lg mx-auto">
                                    <button type="button" onclick="removeEditImage()" class="mt-2 text-red-600 hover:text-red-800 text-sm">
                                        <i class="fas fa-trash mr-1"></i>Hapus Gambar
                                    </button>
                                </div>
                                <div id="editImageUploadArea" class="${question.image ? 'hidden' : ''} text-center">
                                    <i class="fas fa-image text-3xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-600 mb-2">Klik untuk upload gambar</p>
                                    <button type="button" onclick="document.getElementById('editQuestionImage').click()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-upload mr-2"></i>Pilih Gambar
                                    </button>
                                    <p class="text-xs text-gray-500 mt-2">Format: JPG, PNG, GIF (Max: 5MB)</p>
                                </div>
                            </div>
                        </div>
                        
                        <div id="editOptionsContainer">
                            <!-- Options will be generated based on question type -->
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jawaban Benar</label>
                            <select id="editCorrectAnswer" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <!-- Options will be populated -->
                            </select>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                                Batal
                            </button>
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition-colors">
                                Update Soal
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.classList.remove('hidden');
            
            // Setup form handlers for edit
            setupEditQuestionForm(question);
        }

        function setupEditQuestionForm(question) {
            const typeSelect = document.getElementById('editQuestionType');
            const optionsContainer = document.getElementById('editOptionsContainer');
            const correctSelect = document.getElementById('editCorrectAnswer');
            
            function updateEditOptions() {
                const type = typeSelect.value;
                
                if (type === 'multiple_choice') {
                    optionsContainer.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pilihan Jawaban</label>
                            <div class="space-y-2">
                                <input type="text" id="editOption0" placeholder="Pilihan A" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required value="${question.options[0] || ''}">
                                <input type="text" id="editOption1" placeholder="Pilihan B" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required value="${question.options[1] || ''}">
                                <input type="text" id="editOption2" placeholder="Pilihan C" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required value="${question.options[2] || ''}">
                                <input type="text" id="editOption3" placeholder="Pilihan D" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required value="${question.options[3] || ''}">
                            </div>
                        </div>
                    `;
                    
                    correctSelect.innerHTML = `
                        <option value="0" ${question.correct === 0 ? 'selected' : ''}>A</option>
                        <option value="1" ${question.correct === 1 ? 'selected' : ''}>B</option>
                        <option value="2" ${question.correct === 2 ? 'selected' : ''}>C</option>
                        <option value="3" ${question.correct === 3 ? 'selected' : ''}>D</option>
                    `;
                } else {
                    optionsContainer.innerHTML = '';
                    correctSelect.innerHTML = `
                        <option value="0" ${question.correct === 0 ? 'selected' : ''}>Benar</option>
                        <option value="1" ${question.correct === 1 ? 'selected' : ''}>Salah</option>
                    `;
                }
            }
            
            typeSelect.addEventListener('change', updateEditOptions);
            updateEditOptions();
            
            // Setup image upload for edit form
            setupEditImageUpload();
            
            // Form submission
            document.getElementById('editQuestionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const type = typeSelect.value;
                const questionText = document.getElementById('editQuestionText').value;
                const correct = parseInt(correctSelect.value);
                
                let options = [];
                if (type === 'multiple_choice') {
                    options = [
                        document.getElementById('editOption0').value,
                        document.getElementById('editOption1').value,
                        document.getElementById('editOption2').value,
                        document.getElementById('editOption3').value
                    ];
                } else {
                    options = ['Benar', 'Salah'];
                }
                
                // Get image data if uploaded or keep existing
                let imageData = question.image; // Keep existing image by default
                const previewImg = document.getElementById('editPreviewImg');
                if (previewImg && previewImg.src && previewImg.src.startsWith('data:')) {
                    imageData = previewImg.src; // New image uploaded
                } else if (!document.getElementById('editImagePreview').classList.contains('hidden')) {
                    imageData = question.image; // Keep existing image
                } else {
                    imageData = null; // Image was removed
                }
                
                // Update the question
                const questionIndex = questions.findIndex(q => q.id === question.id);
                if (questionIndex !== -1) {
                    questions[questionIndex] = {
                        ...question,
                        type: type,
                        question: questionText,
                        options: options,
                        correct: correct,
                        image: imageData
                    };
                }
                
                closeModal();
                loadQuestionsList();
                updateStats();
                
                showNotification('Soal berhasil diupdate!', 'success');
            });
        }

        function deleteQuestion(id) {
            if (confirm('Apakah Anda yakin ingin menghapus soal ini?')) {
                questions = questions.filter(q => q.id !== id);
                loadQuestionsList();
                updateStats();
                showNotification('Soal berhasil dihapus!', 'success');
            }
        }

        function clearAllQuestions() {
            if (confirm('Apakah Anda yakin ingin menghapus SEMUA soal? Tindakan ini tidak dapat dibatalkan!')) {
                questions = [];
                loadQuestionsList();
                updateStats();
                showNotification('Semua soal berhasil dihapus!', 'success');
            }
        }

        function saveResult(result) {
            const results = JSON.parse(localStorage.getItem('quizResults') || '[]');
            results.push(result);
            localStorage.setItem('quizResults', JSON.stringify(results));
        }

        function showResults() {
            const results = JSON.parse(localStorage.getItem('quizResults') || '[]');
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Hasil Quiz Siswa</h2>
                    
                    ${results.length === 0 ? `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-chart-bar text-4xl mb-4"></i>
                            <p>Belum ada hasil quiz.</p>
                        </div>
                    ` : `
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left">Nama</th>
                                        <th class="px-4 py-2 text-left">Kelas</th>
                                        <th class="px-4 py-2 text-center">Nilai</th>
                                        <th class="px-4 py-2 text-center">Benar</th>
                                        <th class="px-4 py-2 text-left">Waktu</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${results.map(result => `
                                        <tr class="border-t">
                                            <td class="px-4 py-2">${result.student.name}</td>
                                            <td class="px-4 py-2">${result.student.class}</td>
                                            <td class="px-4 py-2 text-center font-semibold ${result.score >= 70 ? 'text-green-600' : 'text-red-600'}">${result.score}</td>
                                            <td class="px-4 py-2 text-center">${result.correct}/${result.total}</td>
                                            <td class="px-4 py-2">${new Date(result.timestamp).toLocaleString('id-ID')}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `}
                    
                    <div class="flex justify-end space-x-3 pt-4 mt-4 border-t">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                            Tutup
                        </button>
                        ${results.length > 0 ? `
                            <button onclick="exportResults()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                                <i class="fas fa-download mr-2"></i>Export Excel
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function exportResults() {
            const results = JSON.parse(localStorage.getItem('quizResults') || '[]');
            
            if (results.length === 0) {
                alert('Tidak ada data untuk diekspor.');
                return;
            }
            
            // Create CSV content
            let csv = 'Nama,Kelas,No. Absen,Nilai,Benar,Total,Waktu\n';
            
            results.forEach(result => {
                csv += `"${result.student.name}","${result.student.class}","${result.student.number}",${result.score},${result.correct},${result.total},"${new Date(result.timestamp).toLocaleString('id-ID')}"\n`;
            });
            
            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `hasil_quiz_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Hasil berhasil diekspor!', 'success');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium transition-all duration-300 transform translate-x-full`;
            
            if (type === 'success') {
                notification.classList.add('bg-green-600');
            } else if (type === 'error') {
                notification.classList.add('bg-red-600');
            } else {
                notification.classList.add('bg-blue-600');
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Close modal when clicking outside
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d76d5cf22cce86',t:'MTc1NzU5NjQ1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
